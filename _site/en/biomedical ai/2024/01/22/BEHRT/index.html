<!DOCTYPE html>
<html lang="en-us">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <!--site.title site.tagline-->
  <title>
    
      [Paper] BEHRT: Transformer for Electronic Health Records (2020) &middot; Coffee chats
    
  </title>

  
  <link rel="canonical" href="https://alatteaday.github.io/en/biomedical%20ai/2024/01/22/BEHRT/">
  

  <link rel="stylesheet" href="https://alatteaday.github.io/en/public/css/poole.css">
  <link rel="stylesheet" href="https://alatteaday.github.io/en/public/css/syntax.css">
  <link rel="stylesheet" href="https://alatteaday.github.io/en/public/css/lanyon.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Serif:400,400italic,700%7CPT+Sans:400">

  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="https://alatteaday.github.io/en/public/favicon.ico/apple-touch-icon.png">
  <link rel="shortcut icon" href="https://alatteaday.github.io/en/public/favicon.ico/favicon.ico">

  <link rel="alternate" type="application/rss+xml" title="RSS" href="https://alatteaday.github.io/en/atom.xml">

  
</head>


  <body>

    <!-- Target for toggling the sidebar `.sidebar-checkbox` is for regular
     styles, `#sidebar-checkbox` for behavior. -->
<input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox">

<!-- Toggleable sidebar -->
<div class="sidebar" id="sidebar">
  <div class="sidebar-item">
    <p>Curation of studies, techs, ideas and her journey as a maching learning engineer</p>
  </div>

  <nav class="sidebar-nav">
    <a class="sidebar-nav-item" href="https://alatteaday.github.io/en/">Home</a>

    

    
    
      
        
        
      
    
      
        
        
      
    
      
        
          <a class="sidebar-nav-item" 
          href="https://alatteaday.github.io/en/about/">About</a>
        
        
      
    
      
    
      
        
        
          <a class="sidebar-nav-item "
          href="https://alatteaday.github.io/en/category/CV/">Computer Vision</a>
        
      
    
      
        
        
          <a class="sidebar-nav-item "
          href="https://alatteaday.github.io/en/category/NLP/">Natural Language Processing</a>
        
      
    
      
        
        
          <a class="sidebar-nav-item "
          href="https://alatteaday.github.io/en/category/bio/">Biomedical AI</a>
        
      
    
      
        
        
          <a class="sidebar-nav-item "
          href="https://alatteaday.github.io/en/category/error/">Error Resolution</a>
        
      
    
      
    
      
        
          <a class="sidebar-nav-item" 
          href="https://alatteaday.github.io/en/tags/">Tags</a>
        
        
      
    
    <!--
    <a class="sidebar-nav-item" href="/en/archive/v1.1.0.zip">Download</a>
    <a class="sidebar-nav-item" href="">GitHub project</a>
    <span class="sidebar-nav-item">Currently v1.1.0</span> 
    -->
  </nav>

  <div class="sidebar-item">
    <p>
      &copy; 2024. All rights reserved.
    </p>
  </div>
</div>


    <!-- Wrap is the content to shift when toggling the sidebar. We wrap the
         content to avoid any CSS collisions with our real content. -->
    <!--site.title site.tagline-->
    <div class="wrap">
      <div class="masthead">
        <div class="container" >
          <h3 class="masthead-title">
            <a href="/en/" title="Home">Coffee chats</a>
            <small>with strangers</small>
          </h3>
          <div class="lang-switcher">
    
    
eng
    

    
    
        
<a href=" /biomedical%20ai/2024/01/22/BEHRT/">kor</a>
        
    

</div>
        </div>
      </div>

      <div class="container content">
        <div class="post">
  <h1 class="post-title">[Paper] BEHRT: Transformer for Electronic Health Records (2020)</h1>
  <p class="post-date">22 Jan 2024&nbsp;&nbsp;&nbsp;&nbsp;
    <!--<span class="post-date">22 Jan 2024</span>-->
    
      
        
          <span class="tag">
            <a href=".">
              #bio
            </a>
          </span>
        
      
        
          <span class="tag">
            <a href=".">
              #ehr
            </a>
          </span>
        
      
        
          <span class="tag">
            <a href=".">
              #transformer
            </a>
          </span>
        
      
    
  </p>
  <p>Li, Yikuan, et al. “BEHRT: transformer for electronic health records.” <em>Scientific reports</em> 10.1 (2020): 7155.</p>

<p><a href="https://www.nature.com/articles/s41598-020-62922-y">paper link</a></p>

<h2 id="points">Points</h2>

<ol>
  <li>
    <p><strong>BEHRT</strong> (BERT for EHR): BERT-based architecture</p>

    <ul>
      <li>
        <p>In EHR, certain diseases can be reversed, or the time interval between two diagnoses can be shorter or longer than recorded.</p>

        <p>:arrow_forward: Bidirectional contextual awareness of the model’s representation is a big advantage with EHR data.</p>
      </li>
    </ul>
  </li>
  <li>Transfer Learning: pre-training on predicting of masked disease words, such as Masked Language Modeling (MLM), and then fine-tuning on three disease prediction tasks</li>
  <li>Disease embeddings: show the relations between the various diseases</li>
</ol>

<h2 id="background">Background</h2>

<ul>
  <li>
    <p>In traditional research on EHR data, individuals are represented by models as features. Experts had to define the appropriate features.</p>
  </li>
  <li>Studies applying Deep Learning (DL) to EHR started to show that DL models can outperform the traditional Machine Learning (ML) methods</li>
  <li>With DL architectures for sequence data, such as Recurrent Neural Networks (RNNs), the application of DL models for EHR was improved in terms of capturing the long-term dependencies among events.</li>
  <li>Similarities between sequences in EHR and natural language lead to the successful transferability of techniques</li>
</ul>

<h2 id="method">Method</h2>

<h3 id="data">Data</h3>

<p>Clinical Practice Research Datalink (CPRD)</p>

<ul>
  <li>
    <p>one of the largest linked primary care EHR systems</p>
  </li>
  <li>
    <p>Contains longitudinal data from a network of 674 general practitioner practices in the UK</p>
  </li>
</ul>

<p><img src="https://github.com/alatteaday/alatteaday.github.io/blob/gh-pages/_images/2024-01-22-behrt/1_fig1.png?raw=true" alt="스크린샷 2024-02-29 오후 8.29.23" /></p>

<ul>
  <li>
    <p>from ​8 million patients (eligible for linkage to HES, meet CPRD’s quality standards) to 1.6 million patients  (having at least 5 visits in the EHR)</p>
  </li>
  <li>
    <p>Only the data from GP practices considered in this study, which consented to record linkage with HES</p>
  </li>
</ul>

<h3 id="input-features">Input Features</h3>

<p><img src="https://github.com/alatteaday/alatteaday.github.io/blob/gh-pages/_images/2024-01-22-behrt/2_fig2.png?raw=true" alt="스크린샷 2024-02-29 오후 8.30.30" /></p>

<ul>
  <li>Only consider the diagnoses and ages</li>
</ul>

<p>The patient \(p\)’s EHR:
\(V_p={v^1_p},{v^2_p},{v^3_p}, ...,{v^n_p}\)
The patient \(p\)’s EHR of the \(j\)th visit: \(v^j_p\)</p>

<p>\(v^j_p\) is a list consisting of single or multiple \(m\) diagnoses: \(v^j_p=\{d_1, ...d_m\}\)</p>

<p>Input sequence:
\(I_p=\{CLS, v^1_p, SEP, v^2_p, SEP,...,v^{n_p}_p, SEP\}\)</p>

<ul>
  <li>
    <p>\(CLS\) token: the start of a medical history</p>
  </li>
  <li>
    <p>\(SEP\) token: between visits</p>
  </li>
</ul>

<h3 id="embeddings">Embeddings</h3>

<p><img src="https://github.com/alatteaday/alatteaday.github.io/blob/gh-pages/_images/2024-01-22-behrt/3_fig3.png?raw=true" alt="스크린샷 2024-02-29 오후 8.31.09" /></p>

<ul>
  <li>
    <p>A combination of 4 embeddings: disease + position + age + visit segment</p>
  </li>
  <li>
    <p>Disease embeddings: past diseases can improve the accuracy of the prediction for future diagnoses</p>
  </li>
  <li>
    <p>Positional encodings: determine the relative position in the EHR sequence</p>
  </li>
</ul>

<h3 id="tasks">Tasks</h3>

<p>Pre-training: prediction of masked disease words (MLM)</p>

<ul>
  <li>86.5% of the disease words were unchanged, 12% of them replaced with the mask token, and the remaining 1.5% words replaced with randomly-chosen disease words</li>
</ul>

<p>Fine-tuning: 3 different disease prediction tasks</p>

<ul>
  <li>
    <p>Prediction of diseases in the next visit (T1)</p>

    <ol>
      <li>Randomly choose an index \(j (3&lt;j&lt;n_p)\) for each patient</li>
      <li>Form input as $$x_p={v^1_p, …, v^j_p}</li>
      <li>Output \(y_p=w_{j+1}\), \(w_{j+1}\) is a multi-one-hot vector, indexed for disease that exist in \(v^{j+1}_p\)</li>
    </ol>

    <ul>
      <li>Each patient contributes only an input-output pair to the training and evaluation process.</li>
    </ul>
  </li>
  <li>
    <p>Prediction of diseases in the next 6 months (T2) &amp; in the next 12 months (T3)</p>

    <ol>
      <li>Not include patients that don’t have 6 or 12 months worth of EHR in the analysis</li>
      <li>choose \(j\) randomly from \((3, n*)\), where \(n\*\) is the highest index after 6 or 12 months</li>
      <li>output \(y_p=w_{6m}\) and \(y_p=w_{12m}\)</li>
    </ol>
  </li>
  <li>
    <p>The number of patients for each task: 699K, 391K, 342K</p>
  </li>
</ul>

<h2 id="results">Results</h2>

<h4 id="disease-embeddings">Disease Embeddings</h4>

<p><img src="https://github.com/alatteaday/alatteaday.github.io/blob/gh-pages/_images/2024-01-22-behrt/4_fig4.png?raw=true" alt="스크린샷 2024-03-05 오전 9.39.18" /></p>

<p>T-SNE Results</p>

<ul>
  <li>
    <p>The natural stratification of gender-specific diseases</p>
  </li>
  <li>
    <p>The natural clusters are formed that in most cases consist fo disease of the same chapter</p>
  </li>
  <li>
    <p>10 closest diseases by cosine similarity of their embeddings are founded as similar as those provided by a clinical researcher (0.757 overlab) - Supplementary table S3</p>
  </li>
</ul>

<h4 id="attention-and-interpretability">Attention and Interpretability</h4>

<p>Found the relationships among events which goes beyond temporal/sequence adjacency</p>

<p>Analysed the attention-based patterns by Vig</p>

<ul>
  <li>Strong connections between rheumatoid arthritis and enthesopathies and synovial disorders :arrow_right: Attention can go beyond recent events and find long-range dependencies among diseases</li>
</ul>

<h4 id="disease-prediction">Disease Prediction</h4>

<p>Metrics: average precision score(APS), AUROC</p>

<ul>
  <li>APS: a weighted mean of precision and recall achieved at different thresholds</li>
</ul>

<ol>
  <li>
    <p>Performance scores</p>

    <p><img src="https://github.com/alatteaday/alatteaday.github.io/blob/gh-pages/_images/2024-01-22-behrt/5_table1.png?raw=true" alt="스크린샷 2024-03-05 오전 9.49.39" style="zoom: 50%;" /></p>

    <p>:arrow_forward: Outperformed the best model by more than around 8% in predicting for a range of more than 300 diseases</p>
  </li>
  <li>
    <p>Comparing performance for each disease</p>

    <p>APS and AUROC scores with the all \(y_p\) and \(y*_p\) vectors of a disease</p>
  </li>
</ol>

<p><img src="https://github.com/alatteaday/alatteaday.github.io/blob/gh-pages/_images/2024-01-22-behrt/6_fig6.png?raw=true" alt="스크린샷 2024-03-05 오전 10.08.39" /></p>

<p><img src="https://github.com/alatteaday/alatteaday.github.io/blob/gh-pages/_images/2024-01-22-behrt/7_table2.png?raw=true" alt="스크린샷 2024-03-05 오전 10.08.53" style="zoom: 50%;" /></p>

<h3 id="discussion">Discussion</h3>

<ul>
  <li>Flexibility of BEHRT from employed 4 key concepts from EHR: disease, age, segment, position
    <ul>
      <li>gains insights about underlying generating process of EHR</li>
      <li>Distributed/complex representations that are capable of capturing concepts of disease</li>
      <li>Future work: adding new concepts to the embeddings</li>
    </ul>
  </li>
  <li>Disease embeddings provide great insights into how various diseases are related to each other: co-occurrence and closeness of diseases
    <ul>
      <li>Could be used for future research as reliable disease vectors</li>
    </ul>
  </li>
  <li>
    <p>Important features of EHR for prediction</p>

    <ul>
      <li>
        <p>Robust, gender-specific predictions without inclusion of gender</p>
      </li>
      <li>
        <p>Position was important</p>
      </li>
      <li>
        <p>Age embeddings might be vital in diagnosing age-related diseases</p>
      </li>
    </ul>
  </li>
</ul>


</div>


<div class="related">
  <h2 class="related-title">Related posts</h2>
  <ul class="related-posts">
    
      <li>
        <h3>
          <a href="/en/error%20resolution/2024/02/20/dockercmd/">
            Docker CMDs&nbsp;
            <small>20 Feb 2024</small>
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="/en/biomedical%20ai/2024/02/15/transformehr/">
            [Paper] TransformEHR: transformer-based encoder-decoder generative model to enhance prediction of disease outcomes using electronic health records (2023)&nbsp;
            <small>15 Feb 2024</small>
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="/en/biomedical%20ai/2024/01/31/WMHandAbTau/">
            [Study] Relations between white matter hyperintensity (WMH) feature and amyloid-beta (β-amyloid) and tau burden&nbsp;
            <small>31 Jan 2024</small>
          </a>
        </h3>
      </li>
    
  </ul>
</div>


      </div>
    </div>

    <label for="sidebar-checkbox" class="sidebar-toggle"></label>

    <script src='/public/js/script.js'></script>
  </body>
</html>
